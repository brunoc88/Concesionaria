Teoria de Cookies

Â¿Por quÃ© no hace falta limpiar 'Bearer ' en cookies?
ğŸ”‘ Porque las cookies no llevan prefijos como 'Bearer', simplemente almacenan el valor tal cual se lo das.
En cookies: el token estÃ¡ en req.cookies.token â†’ ya es el token limpio.

En headers (con Authorization): vos mismo ponÃ©s el valor como:

Authorization: Bearer eyJhbGciOi...

Entonces tenÃ©s que remover el 'Bearer ' para obtener solo el token antes de verificarlo.

ğŸ” Resumen:

Fuente	            Formato recibido	            Â¿Hay que limpiar?
Authorization	     "Bearer eyJh...xyz"	            âœ… SÃ­, remover "Bearer "
Cookie	           "token=eyJh...xyz"	              âŒ No, ya viene limpio

ğŸª res.cookie() â€“ Â¿QuÃ© hace y quÃ© significan sus opciones?
ğŸ“Œ Sintaxis:

res.cookie(nombre, valor, opciones)
Ejemplo:

res.cookie('token', token, {
  httpOnly: true,
  secure: true,
  sameSite: 'strict',
  maxAge: 1000 * 60 * 60 // 1 hora
})


ğŸ” Opciones explicadas:
Propiedad	                   QuÃ© hace
httpOnly	                   Impide que el cliente acceda al token desde document.cookie (mÃ¡s seguro)
secure	                     Solo envÃ­a la cookie por HTTPS. En desarrollo podÃ©s ponerlo en false
sameSite	                   Previene ataques CSRF (strict = no enviar en cross-site requests)
maxAge	                     Tiempo de vida de la cookie en milisegundos (1 hora en el ejemplo)
path	                       Opcional. Define en quÃ© rutas se manda la cookie ('/' por defecto)

âŒ res.clearCookie() â€“ Â¿QuÃ© hace?
Elimina la cookie en el navegador del cliente. Internamente lo que hace es:

Mandar una cookie con el mismo nombre y:

Expirada (expires en el pasado)

Sin valor


res.clearCookie('token')


âœ… Es Ãºtil para:
Logout

Revocar sesiÃ³n

Eliminar cookies de forma segura

â“ Â¿res.cookie() y res.clearCookie() son propiedades de res?
SÃ­, son mÃ©todos propios del objeto res (response) provisto por Express. No los creÃ¡s vos, vienen integrados cuando usÃ¡s cookie-parser.

Cuando hacÃ©s esto:

app.use(cookieParser())
EstÃ¡s extendiendo req y res para que puedan:

Leer cookies (req.cookies) 

Escribir cookies (res.cookie)

Borrar cookies (res.clearCookie)

ğŸ“Œ ConclusiÃ³n rÃ¡pida
Cookies no tienen prefijo, el token viene limpio.

Authorization sÃ­ lo tiene, por eso hay que quitar 'Bearer ' antes de usarlo.

res.cookie y res.clearCookie vienen del middleware cookie-parser.

Las propiedades (httpOnly, secure, sameSite, etc.) son configuraciones de seguridad estÃ¡ndar.

MAS SOBRE SECURE:


Si estÃ¡s en desarrollo, y configurÃ¡s la cookie con secure: false, todo va a seguir funcionando perfectamente mientras estÃ©s trabajando en http://localhost.

SÃ­, es exactamente como decÃ­s:
secure: false â†’ la cookie se enviarÃ¡ en peticiones HTTP normales, como las de localhost en desarrollo.

secure: true â†’ la cookie solo se enviarÃ¡ si la conexiÃ³n es HTTPS, lo cual es lo correcto en producciÃ³n para mantener la seguridad.